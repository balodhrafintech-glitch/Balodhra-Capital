<!DOCTYPE html>
<html lang="gu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LMS ડેશબોર્ડ</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7f9;
        }
        .mobile-container {
            max-width: 420px;
            margin: 0 auto;
            min-height: 100vh;
            background-color: #ffffff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .scroll-container::-webkit-scrollbar {
            display: none;
        }
        .scroll-container {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        .icon-box {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 48px;
            height: 48px;
            border-radius: 9999px;
            margin-bottom: 8px;
        }
        .section-card {
            min-width: 120px;
            padding: 12px;
            border-radius: 12px;
            background-color: #f0f4f7;
            text-align: center;
            transition: transform 0.1s;
        }
        .section-card:active {
            transform: scale(0.98);
        }
    </style>
</head>
<body>

<div id="app" class="mobile-container p-4">
    <!-- Top Navigation -->
    <header class="flex justify-between items-center py-2 mb-4">
        <div class="flex items-center space-x-2">
            <i data-lucide="home" class="w-6 h-6 text-orange-600"></i>
            <span class="text-xl font-bold text-gray-800">હોમ</span>
        </div>
        <div class="flex items-center space-x-4">
            <i data-lucide="bell" class="w-6 h-6 text-gray-500 cursor-pointer hover:text-orange-600"></i>
            <div id="profile-icon" class="w-8 h-8 rounded-full bg-orange-200 flex items-center justify-center text-orange-800 font-semibold text-sm cursor-pointer hover:ring-2 ring-orange-400">
                P
            </div>
        </div>
    </header>

    <!-- Greeting Section -->
    <div class="mb-6 bg-orange-50 p-4 rounded-xl shadow-sm">
        <p class="text-sm text-gray-600">શુભ બપોર,</p>
        <h1 id="user-greeting" class="text-2xl font-extrabold text-orange-600">યુઝર</h1>
        <p class="text-xs text-gray-500 mt-1">યુઝર ID: <span id="user-id-display">...</span></p>
    </div>

    <!-- Main Feature Grid (Inspired by the image layout) -->
    <section class="mb-8">
        <h2 class="text-lg font-semibold text-gray-700 mb-4">મુખ્ય ફિચર્સ</h2>
        <div class="grid grid-cols-3 gap-4">

            <!-- 1. Test Series -->
            <button class="flex flex-col items-center justify-center p-3 rounded-xl bg-red-100 hover:bg-red-200 transition duration-150 shadow-md">
                <div class="icon-box bg-red-400">
                    <i data-lucide="test-tube-2" class="w-6 h-6 text-white"></i>
                </div>
                <span class="text-xs font-medium text-gray-700">ટેસ્ટ સિરીઝ</span>
            </button>

            <!-- 2. Video Lectures -->
            <button class="flex flex-col items-center justify-center p-3 rounded-xl bg-indigo-100 hover:bg-indigo-200 transition duration-150 shadow-md">
                <div class="icon-box bg-indigo-400">
                    <i data-lucide="play-circle" class="w-6 h-6 text-white"></i>
                </div>
                <span class="text-xs font-medium text-gray-700">વીડિયો લેક્ચર્સ</span>
            </button>

            <!-- 3. PDF Materials -->
            <button class="flex flex-col items-center justify-center p-3 rounded-xl bg-green-100 hover:bg-green-200 transition duration-150 shadow-md">
                <div class="icon-box bg-green-400">
                    <i data-lucide="book-open-check" class="w-6 h-6 text-white"></i>
                </div>
                <span class="text-xs font-medium text-gray-700">PDF સામગ્રી</span>
            </button>

            <!-- 4. Syllabus -->
            <button class="flex flex-col items-center justify-center p-3 rounded-xl bg-yellow-100 hover:bg-yellow-200 transition duration-150 shadow-md">
                <div class="icon-box bg-yellow-400">
                    <i data-lucide="list-checks" class="w-6 h-6 text-white"></i>
                </div>
                <span class="text-xs font-medium text-gray-700">સિલેબસ</span>
            </button>

            <!-- 5. Notifications -->
            <button class="flex flex-col items-center justify-center p-3 rounded-xl bg-purple-100 hover:bg-purple-200 transition duration-150 shadow-md">
                <div class="icon-box bg-purple-400">
                    <i data-lucide="megaphone" class="w-6 h-6 text-white"></i>
                </div>
                <span class="text-xs font-medium text-gray-700">નોટિફિકેશન્સ</span>
            </button>

            <!-- 6. Results -->
            <button class="flex flex-col items-center justify-center p-3 rounded-xl bg-teal-100 hover:bg-teal-200 transition duration-150 shadow-md">
                <div class="icon-box bg-teal-400">
                    <i data-lucide="trophy" class="w-6 h-6 text-white"></i>
                </div>
                <span class="text-xs font-medium text-gray-700">પરિણામો</span>
            </button>

        </div>
    </section>

    <!-- Exam Categories Section -->
    <section class="mb-8">
        <h2 class="text-lg font-semibold text-gray-700 mb-4">પરીક્ષા શ્રેણીઓ (Exam-wise Filter)</h2>
        <div id="exam-categories" class="scroll-container flex space-x-3 overflow-x-auto pb-2">
            <!-- Exam cards will be inserted here by JS -->
        </div>
    </section>

    <!-- Subject Categories Section -->
    <section class="mb-8">
        <h2 class="text-lg font-semibold text-gray-700 mb-4">વિષય શ્રેણીઓ</h2>
        <div id="subject-categories" class="scroll-container flex space-x-3 overflow-x-auto pb-2">
            <!-- Subject cards will be inserted here by JS -->
        </div>
    </section>
</div>

<script type="module">
    // Firebase Imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
    import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // Uncomment the line below to see Firebase debug logs in the console
    // setLogLevel('Debug');

    // Global Firebase Variables (Provided by Canvas Environment)
    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-lms-app-id';
    const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
    const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

    let app;
    let auth;
    let db;
    let userId = null;

    // --- Content Data (Based on User Request) ---
    const exams = [
        "GPSC Class 1/2", "GPSC DySO", "Talati", "Junior Clerk", "Forest Guard",
        "Police Constable", "TET-1 / TET-2", "HTAT", "Bin Sachivalay", "SSC / Railway"
    ];

    const subjects = [
        "ગુજરાતી", "અંગ્રેજી", "ગણિત", "રીઝનિંગ", "સામાન્ય જ્ઞાન", "વર્તમાન પ્રવાહો",
        "વિજ્ઞાન", "ઇતિહાસ", "ભૂગોળ", "પોલિટી", "અર્થશાસ્ત્ર", "કમ્પ્યુટર"
    ];

    // --- Utility Functions ---

    // Simple function to get a color based on an index (for variety)
    function getColor(index, type = 'exam') {
        const examColors = ['bg-blue-500', 'bg-red-500', 'bg-green-500', 'bg-yellow-500', 'bg-purple-500', 'bg-pink-500'];
        const subjectColors = ['bg-indigo-500', 'bg-orange-500', 'bg-cyan-500', 'bg-lime-500', 'bg-fuchsia-500', 'bg-teal-500'];
        const colors = type === 'exam' ? examColors : subjectColors;
        return colors[index % colors.length];
    }

    function renderCards(data, containerId, type) {
        const container = document.getElementById(containerId);
        if (!container) return;

        container.innerHTML = '';
        data.forEach((item, index) => {
            const colorClass = getColor(index, type);
            const card = document.createElement('div');
            card.className = `section-card ${colorClass} text-white shadow-lg flex flex-col justify-center items-center cursor-pointer`;
            card.innerHTML = `
                <span class="text-lg font-bold">${item.charAt(0)}</span>
                <span class="mt-2 text-sm font-medium whitespace-nowrap">${item}</span>
            `;
            // Add click handler (placeholder action)
            card.onclick = () => console.log(`${type === 'exam' ? 'પરીક્ષા' : 'વિષય'}: ${item} ક્લિક કર્યું.`);
            container.appendChild(card);
        });
    }

    // --- Firebase Setup and Authentication ---

    async function initializeFirebase() {
        if (!firebaseConfig) {
            console.error("Firebase configuration is missing.");
            return;
        }

        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);

            // Authentication
            if (initialAuthToken) {
                await signInWithCustomToken(auth, initialAuthToken);
            } else {
                await signInAnonymously(auth);
            }

            // Listen for Auth State Changes
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    userId = user.uid;
                    document.getElementById('user-id-display').textContent = userId;
                    document.getElementById('user-greeting').textContent = `યુઝર ${userId.substring(0, 4)}`; // Showing first 4 chars of ID

                    // Fetch and display user profile data (placeholder)
                    fetchUserProfile(userId);

                } else {
                    userId = null;
                    document.getElementById('user-id-display').textContent = 'Signed Out';
                    document.getElementById('user-greeting').textContent = `મહેમાન`;
                }
            });

        } catch (error) {
            console.error("Firebase initialization or sign-in failed:", error);
        }
    }

    // --- Firestore Data Functions ---

    function fetchUserProfile(uid) {
        if (!db || !uid) return;

        // Path for private user data
        const userDocRef = doc(db, `artifacts/${appId}/users/${uid}/profile`, 'user-details');

        // Real-time listener for user profile data
        onSnapshot(userDocRef, (docSnap) => {
            if (docSnap.exists()) {
                const userData = docSnap.data();
                // If a name field exists in Firestore, use it
                const userName = userData.name || `યુઝર ${uid.substring(0, 4)}`;
                document.getElementById('user-greeting').textContent = userName;
                document.getElementById('profile-icon').textContent = userName.charAt(0);
                console.log("User Profile Data:", userData);
            } else {
                console.log("No profile data found for user. Using default name.");
                // Placeholder to set a default initial profile data if needed
                // setDoc(userDocRef, { name: `નવો યુઝર ${uid.substring(0, 4)}`, lastLogin: new Date() }, { merge: true });
            }
        }, (error) => {
            console.error("Error fetching user profile:", error);
        });
    }

    // --- Application Initialization ---

    document.addEventListener('DOMContentLoaded', () => {
        // Initialize Lucide icons
        lucide.createIcons();

        // Render the static content sections
        renderCards(exams, 'exam-categories', 'exam');
        renderCards(subjects, 'subject-categories', 'subject');

        // Initialize Firebase
        initializeFirebase();

        // Placeholder for event listeners for the main buttons
        document.querySelectorAll('button').forEach(button => {
            button.addEventListener('click', (e) => {
                const text = e.currentTarget.querySelector('span')?.textContent || 'બટન';
                // Replace this with actual navigation logic
                console.log(`${text} બટન ક્લિક થયું.`);
            });
        });

    });

</script>
</body>
</html>>

